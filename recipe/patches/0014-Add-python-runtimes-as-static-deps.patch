From ea022e52254792877051cc0ff1f12acadfefe277 Mon Sep 17 00:00:00 2001
From: "Uwe L. Korn" <uwe.korn@quantco.com>
Date: Fri, 27 Oct 2023 11:38:30 +0200
Subject: [PATCH 14/15] Add python runtimes as static deps

---
 tensorflow/compiler/tf2tensorrt/BUILD |  5 +++++
 tensorflow/python/BUILD               |  6 ++++++
 tensorflow/tensorflow.bzl             |  6 ++++++
 tensorflow/tsl/python/lib/core/BUILD  | 11 +++++++++++
 4 files changed, 28 insertions(+)

diff --git a/tensorflow/compiler/tf2tensorrt/BUILD b/tensorflow/compiler/tf2tensorrt/BUILD
index 68ca3881..74515b98 100644
--- a/tensorflow/compiler/tf2tensorrt/BUILD
+++ b/tensorflow/compiler/tf2tensorrt/BUILD
@@ -1050,6 +1050,11 @@ pybind_extension(
         "@snappy//:__subpackages__",
         "//:__subpackages__",
         "@zlib//:__subpackages__",
+        "@python_x86_64-unknown-linux-gnu//:__subpackages__",
+        "@python_x86_64-pc-windows-msvc//:__subpackages__",
+        "@python_x86_64-apple-darwin//:__subpackages__",
+        "@python_aarch64-unknown-linux-gnu//:__subpackages__",
+        "@python_aarch64-apple-darwin//:__subpackages__",
     ],
     deps = [
         ":common_utils",
diff --git a/tensorflow/python/BUILD b/tensorflow/python/BUILD
index 3bab632c..07a4d569 100644
--- a/tensorflow/python/BUILD
+++ b/tensorflow/python/BUILD
@@ -694,6 +694,12 @@ pywrap_tensorflow_macro(
         "@upb//:__subpackages__",
         "@XNNPACK//:__subpackages__",
         "@zlib//:__subpackages__",
+        "@pypi_numpy//:__subpackages__",
+        "@python_x86_64-unknown-linux-gnu//:__subpackages__",
+        "@python_x86_64-pc-windows-msvc//:__subpackages__",
+        "@python_x86_64-apple-darwin//:__subpackages__",
+        "@python_aarch64-unknown-linux-gnu//:__subpackages__",
+        "@python_aarch64-apple-darwin//:__subpackages__",
     ] + tsl_async_value_deps(),
     win_def_file = ":pywrap_tensorflow_filtered_def_file",
     deps = [
diff --git a/tensorflow/tensorflow.bzl b/tensorflow/tensorflow.bzl
index 8d592a44..2b9a8d91 100644
--- a/tensorflow/tensorflow.bzl
+++ b/tensorflow/tensorflow.bzl
@@ -3277,6 +3277,12 @@ def tf_python_pybind_static_deps(testonly = False):
         "@tf_runtime//:__subpackages__",
         "@upb//:__subpackages__",
         "@zlib//:__subpackages__",
+        "@pypi_numpy//:__subpackages__",
+        "@python_x86_64-unknown-linux-gnu//:__subpackages__",
+        "@python_x86_64-pc-windows-msvc//:__subpackages__",
+        "@python_x86_64-apple-darwin//:__subpackages__",
+        "@python_aarch64-unknown-linux-gnu//:__subpackages__",
+        "@python_aarch64-apple-darwin//:__subpackages__",
     ]
     static_deps += tsl_async_value_deps()
     static_deps += [] if not testonly else [
diff --git a/tensorflow/tsl/python/lib/core/BUILD b/tensorflow/tsl/python/lib/core/BUILD
index 9b7cc3fb..ba4df1b1 100644
--- a/tensorflow/tsl/python/lib/core/BUILD
+++ b/tensorflow/tsl/python/lib/core/BUILD
@@ -88,6 +88,12 @@ cc_shared_library(
         "@local_config_python//:__subpackages__",
         "@pybind11//:__subpackages__",
         "@nsync//:__subpackages__",
+        "@pypi_numpy//:__subpackages__",
+        "@python_x86_64-unknown-linux-gnu//:__subpackages__",
+        "@python_x86_64-pc-windows-msvc//:__subpackages__",
+        "@python_x86_64-apple-darwin//:__subpackages__",
+        "@python_aarch64-unknown-linux-gnu//:__subpackages__",
+        "@python_aarch64-apple-darwin//:__subpackages__",
     ],
 )
 
@@ -99,6 +105,11 @@ tsl_pybind_extension(
         "@//:__subpackages__",
         "@pybind11//:__subpackages__",
         "@local_config_python//:__subpackages__",
+        "@python_x86_64-unknown-linux-gnu//:__subpackages__",
+        "@python_x86_64-pc-windows-msvc//:__subpackages__",
+        "@python_x86_64-apple-darwin//:__subpackages__",
+        "@python_aarch64-unknown-linux-gnu//:__subpackages__",
+        "@python_aarch64-apple-darwin//:__subpackages__",
     ],
     deps = [
         ":ml_dtypes_lib",
-- 
2.39.3 (Apple Git-145)

